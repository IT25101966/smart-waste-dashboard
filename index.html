<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Smart Bin Dashboard</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <style>
    body{font-family:sans-serif;margin:0;padding:0;display:flex;flex-direction:column;align-items:center;background:#f0f0f0}
    #authBox,#dashboard{margin-top:50px;padding:20px;border-radius:8px;background:#fff;box-shadow:0 2px 6px rgba(0,0,0,.2)}
    #authBox input{display:block;margin:10px 0;padding:8px;width:250px}
    #authBox button{margin:5px;padding:8px 12px}
    #error{color:red}
    #dashboard{display:none}
    .bin{border:1px solid #ccc;padding:10px;margin:10px;border-radius:6px;background:#fafafa}
  </style>
</head>
<body>
  <div id="authBox">
    <h2>Smart Bin Login</h2>
    <input id="email" type="email" placeholder="Email">
    <input id="pass" type="password" placeholder="Password">
    <button id="btnLogin">Login</button>
    <button id="btnSignup">Sign Up</button>
    <button id="btnGoogle">Login with Google</button>
    <div id="error"></div>
  </div>

  <div id="dashboard">
    <h2>Smart Bin Dashboard</h2>
    <button id="btnLogout">Logout</button>
    <div>
      <label for="diverter">Diverter Position:</label>
      <select id="diverter">
        <option value="paper">Paper üì∞</option>
        <option value="wet">Wet üçÉ</option>
        <option value="metal">Metal ü•´</option>
      </select>
    </div>
    <div id="bins"></div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      databaseURL: "https://YOUR_PROJECT_ID.firebaseio.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db   = firebase.database();

    const $ = id => document.getElementById(id);

    const bins = [
      {key:'paper',label:'Paper üì∞'},
      {key:'wet',label:'Wet üçÉ'},
      {key:'metal',label:'Metal ü•´'}
    ];

    const errorEl = $('error');
    const setErr = m=>errorEl.textContent=m;
    const looksLikeEmail = e=>/^[^@]+@[^@]+\.[^@]+$/.test(e);

    auth.onAuthStateChanged(user=>{
      if(user){
        $('authBox').style.display='none';
        $('dashboard').style.display='block';
        loadBins();
      } else {
        $('authBox').style.display='block';
        $('dashboard').style.display='none';
      }
    });

    function loadBins(){
      const binsDiv=$('bins');
      binsDiv.innerHTML='';
      bins.forEach(b=>{
        const el=document.createElement('div');
        el.className='bin';
        el.id='bin-'+b.key;
        el.textContent=b.label+': loading...';
        binsDiv.appendChild(el);
        db.ref('bins/'+b.key).on('value',snap=>{
          const val=snap.val();
          el.textContent=b.label+': '+(val===null?'N/A':val);
        });
      });
    }

    // Diverter dropdown sync
    $('diverter').onchange=()=>db.ref('diverter').set($('diverter').value);
    db.ref('diverter').on('value', snap => {
      if(snap.val()) $('diverter').value = snap.val();
    });

    $('btnLogout').onclick=()=>auth.signOut();

    function friendlyAuthError(e){
      if(e.code==='auth/user-not-found') return 'No account found.';
      if(e.code==='auth/wrong-password') return 'Wrong password.';
      if(e.code==='auth/email-already-in-use') return 'Email already in use.';
      return e.message;
    }

    $('btnLogin').onclick=async()=>{
      setErr('');
      const email=$('email').value.trim();
      const pass=$('pass').value;
      if(!looksLikeEmail(email)) return setErr('Please enter a valid email address.');
      if(!pass) return setErr('Please enter your password.');
      try{ await auth.signInWithEmailAndPassword(email, pass); }
      catch(e){ setErr(friendlyAuthError(e)); }
    };

    $('btnSignup').onclick=async()=>{
      setErr('');
      const email=$('email').value.trim();
      const pass=$('pass').value;
      if(!looksLikeEmail(email)) return setErr('Please enter a valid email address.');
      if(pass.length<6) return setErr('Password must be at least 6 characters.');
      try{ await auth.createUserWithEmailAndPassword(email, pass); }
      catch(e){ setErr(friendlyAuthError(e)); }
    };

    $('btnGoogle').onclick=async()=>{
      setErr('');
      try{ const provider=new firebase.auth.GoogleAuthProvider(); await auth.signInWithPopup(provider); }
      catch(e){ setErr(friendlyAuthError(e)); }
    };
  </script>
</body>
</html>
