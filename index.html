<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Smart Waste ‚Ä¢ Dashboard + Login</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    /* Auth buttons ‚Äî glossy gradients + hover lift */
    .btn-auth{
      flex:1; border:none; border-radius:12px;
      padding:12px 16px; font-size:15px; font-weight:700; color:#fff;
      cursor:pointer; transition:transform .2s ease, box-shadow .2s ease, opacity .2s ease;
      box-shadow:0 6px 16px rgba(0,0,0,.35);
    }
    .btn-auth:hover{ transform:translateY(-2px); box-shadow:0 10px 22px rgba(0,0,0,.45); }
    .btn-auth:active{ transform:translateY(0); opacity:.9; }
    .btn-signin{ background:linear-gradient(135deg,#16a34a,#22c55e); }   /* green */
    .btn-signup{ background:linear-gradient(135deg,#2563eb,#3b82f6); }   /* blue  */
    .btn-google{ background:linear-gradient(135deg,#34a853,#4285f4); }   /* google-ish */

    :root{
      --bg:#0f172a; --card:rgba(255,255,255,0.06); --text:#e5e7eb; --muted:#94a3b8;
      --accent1:#22c55e; --accent2:#3b82f6; --danger:#ef4444;
    }
    *{box-sizing:border-box;font-family:'Inter',sans-serif}
    body{margin:0;background:linear-gradient(135deg,#0b1022,#0f172a);color:var(--text);min-height:100vh;display:flex;flex-direction:column}

    /* common buttons (dashboard) */
    .btn-main{
      display:inline-flex;align-items:center;justify-content:center;gap:8px;
      background:linear-gradient(90deg,var(--accent1),var(--accent2));
      color:#fff;border:none;border-radius:12px;padding:10px 16px;font-size:14px;font-weight:600;cursor:pointer;
      transition:transform .15s,opacity .2s;
    }
    .btn-main:hover{opacity:.9} .btn-main:active{transform:scale(.97)} .btn-main svg{width:16px;height:16px}
    .btn-ghost{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.15)} .btn-ghost:hover{background:rgba(255,255,255,.12)}

    /* login view */
    .center{min-height:100vh;display:grid;place-items:center}
    .box{width:min(420px,92%);background:var(--card);border-radius:20px;padding:30px 24px;backdrop-filter:blur(14px);box-shadow:0 8px 30px rgba(0,0,0,.5);animation:fadeIn .6s ease}
    h1{margin:0 0 6px;font-size:28px;font-weight:700}
    p{margin:0 0 18px;color:var(--muted)}
    label{display:block;margin:12px 0 6px;color:var(--muted);font-size:14px}
    input{width:100%;padding:12px 14px;border-radius:12px;border:none;outline:none;background:#1e293b;color:var(--text)}
    input:focus{outline:2px solid rgba(59,130,246,.5)}
    .row{display:flex;gap:10px;margin-top:14px}
    .err{margin-top:12px;color:var(--danger);font-size:13px;min-height:18px;text-align:center}

    /* header + topbar row */
    .topbar-row{max-width:1100px;margin:0 auto;padding:0 20px;margin-top:0.5cm;display:flex;align-items:center;justify-content:space-between}
    .user-info{display:flex;align-items:center;gap:10px}
    .user-info .avatar{width:36px;height:36px;border-radius:50%;background:rgba(255,255,255,0.1);display:flex;align-items:center;justify-content:center}
    .user-info .avatar svg{width:20px;height:20px;color:var(--muted)}
    #userEmail{font-size:14px;font-weight:600;color:var(--text)}

    /* dashboard content */
    header{text-align:center;padding:30px 20px}
    header h2{margin:0;font-size:32px;font-weight:800;background:linear-gradient(90deg,var(--accent1),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    header p{color:var(--muted);margin-top:6px}
    .wrap{flex:1;max-width:1100px;margin:auto;padding:20px;display:grid;gap:20px}
    .grid{display:grid;gap:20px;grid-template-columns:repeat(auto-fit,minmax(240px,1fr))}
    .card{background:var(--card);border-radius:20px;padding:20px;backdrop-filter:blur(12px);box-shadow:0 8px 24px rgba(0,0,0,.35);transition:transform .2s;animation:fadeInUp .5s ease}
    .card:hover{transform:translateY(-4px)}
    .title{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;font-size:14px;color:var(--muted)}
    .value{font-size:40px;font-weight:800;margin:10px 0}
    progress{width:100%;height:14px;border-radius:999px;overflow:hidden}
    progress::-webkit-progress-bar{background:#1e293b}
    progress::-webkit-progress-value{background:linear-gradient(90deg,var(--accent1),var(--accent2));transition:width .5s ease}
    footer{margin-top:18px;color:var(--muted);font-size:12px;text-align:right}

    /* badges + small pills */
    .badge{padding:4px 10px;border-radius:999px;font-size:12px;font-weight:600}
    .badge-ok{background:rgba(34,197,94,0.2);color:#22c55e}
    .badge-high{background:rgba(250,204,21,0.2);color:#facc15}
    .badge-full{background:rgba(239,68,68,0.2);color:#ef4444}
    .pill{background:rgba(255,255,255,.1);padding:6px 12px;border-radius:999px;font-size:13px;color:var(--muted)}

    @keyframes fadeIn{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}
    @keyframes fadeInUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
  </style>
</head>
<body>

  <!-- LOGIN -->
  <section id="loginView" class="center" aria-label="Login form">
    <div class="box" role="form" aria-describedby="msg">
      <h1>Welcome</h1>
      <p>Sign in to Smart Waste Dashboard</p>

      <label for="email">Email</label>
      <input id="email" type="email" placeholder="you@example.com" autocomplete="username" />

      <label for="pass">Password</label>
      <input id="pass" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password" />

      <div class="row">
        <button type="button" id="btnLogin"  class="btn-auth btn-signin" aria-label="Sign in">Sign in</button>
        <button type="button" id="btnSignup" class="btn-auth btn-signup" aria-label="Create account">Sign up</button>
      </div>

      <div class="row">
        <button type="button" id="btnGoogle" class="btn-auth btn-google" aria-label="Continue with Google">Continue with Google</button>
      </div>

      <div id="msg" class="err" role="status" aria-live="polite"></div>
    </div>
  </section>

  <!-- DASHBOARD -->
  <section id="appView" style="display:none">
    <!-- user + logout row -->
    <div class="topbar-row">
      <div class="user-info">
        <div class="avatar" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
               stroke-linecap="round" stroke-linejoin="round">
            <path d="M20 21v-2a4 4 0 0 0-3-3.87" />
            <path d="M4 21v-2a4 4 0 0 1 3-3.87" />
            <circle cx="12" cy="7" r="4" />
          </svg>
        </div>
        <span id="userEmail">‚Äî</span>
      </div>

      <button type="button" id="btnLogout" class="btn-main btn-ghost" title="Logout" aria-label="Logout">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
             stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
          <path d="M16 17l5-5-5-5" />
          <path d="M21 12H9" />
        </svg>
        <span class="label">Logout</span>
      </button>
    </div>

    <header>
      <h2>Smart Waste Dashboard</h2>
      <p>Live levels ‚Ä¢ Buzzer & Diverter control</p>
    </header>

    <div class="wrap">
      <div class="grid" id="cards"><!-- cards injected --></div>
      <div class="card">
        <div class="title">Controls</div>
        <div class="row" style="align-items:center;gap:12px">
          <button type="button" id="btnBuzzer" class="btn-main">üîî Toggle Buzzer</button>
          <span class="pill">State: <b id="buzzerState">‚Ä¶</b></span>
        </div>
        <div class="row" style="align-items:center;gap:12px;margin-top:14px">
          <label for="selDiv">üö¶ Diverter:</label>
          <select id="selDiv">
            <option value="0">0 - Paper</option>
            <option value="1">1 - Wet</option>
            <option value="2">2 - Metal</option>
          </select>
          <span class="pill">Current: <b id="divState">‚Ä¶</b></span>
        </div>
        <footer>Last update: <span id="lastUpdate">‚Äî</span></footer>
      </div>
    </div>
  </section>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>

  <script>
    // --- Firebase config (yours) ---
    const firebaseConfig = {
      apiKey: "AIzaSyA3PnnypErikHB7AxzWQoBdoDEXj9fvzl8",
      authDomain: "smartwaste-54559.firebaseapp.com",
      databaseURL: "https://smartwaste-54559-default-rtdb.firebaseio.com",
      projectId: "smartwaste-54559",
      storageBucket: "smartwaste-54559.firebasestorage.app",
      messagingSenderId: "608437398021",
      appId: "1:608437398021:web:79fe5b2362e70cc95c4a6c",
      measurementId: "G-PL74RBYS50"
    };
    firebase.initializeApp(firebaseConfig);

    const auth = firebase.auth();
    const db   = firebase.database();

    const loginView = document.getElementById('loginView');
    const appView   = document.getElementById('appView');
    const $ = id => document.getElementById(id);

    const bins = [
      {key:'paper',label:'Paper üì∞'},
      {key:'wet',label:'Wet üçÉ'},
      {key:'metal',label:'Metal ü•´'}
    ];

    function show(view){ loginView.style.display = view==='login'?'':'none'; appView.style.display = view==='app'?'':'none'; }

    function makeCard(b){
      const el=document.createElement('div'); el.className='card';
      el.innerHTML = `
        <div class="title"><span>${b.label}</span><span id="${b.key}-badge"></span></div>
        <div class="value"><span id="${b.key}-val">0</span>%</div>
        <progress id="${b.key}-bar" max="100" value="0"></progress>`;
      return el;
    }
    function updateCard(key,val){
      const v=Math.max(0,Math.min(100,Number(val)||0));
      $(`${key}-val`).textContent=v;
      $(`${key}-bar`).value=v;
      const badge=$(`${key}-badge`);
      if(v>=90) badge.innerHTML='<span class="badge badge-full">FULL</span>';
      else if(v>=70) badge.innerHTML='<span class="badge badge-high">High</span>';
      else badge.innerHTML='<span class="badge badge-ok">OK</span>';
    }
    function timeago(ts){
      if(!ts) return '‚Äî';
      const d=new Date(ts), diff=(Date.now()-d)/1000;
      if(diff<60) return `${Math.floor(diff)}s ago`;
      if(diff<3600) return `${Math.floor(diff/60)}m ago`;
      if(diff<86400) return `${Math.floor(diff/3600)}h ago`;
      return d.toLocaleString();
    }

    let refs = {};
    function startApp(user){
      $('userEmail').textContent = user.email || user.uid;

      const cardsEl = document.getElementById('cards');
      cardsEl.innerHTML = '';
      bins.forEach(b => cardsEl.appendChild(makeCard(b)));

      refs.bins   = db.ref('bins');
      refs.buzzer = db.ref('commands/buzzer');
      refs.div    = db.ref('commands/diverter');
      refs.last   = db.ref('status/lastUpdate');

      refs.bins.on('value', s => {
        const d = s.val() || {};
        bins.forEach(b => updateCard(b.key, d[b.key] || 0));
        refs.last.set(Date.now());
      });
      refs.buzzer.on('value', s => { $('buzzerState').textContent = s.val() ? 'ON' : 'OFF'; });
      refs.div.on('value', s => {
        const v = s.val() || 0;
        $('divState').textContent = v;
        $('selDiv').value = v;
      });
      refs.last.on('value', s => { $('lastUpdate').textContent = timeago(s.val()); });

      $('btnBuzzer').onclick = async () => {
        try{
          const cur = (await refs.buzzer.get()).val() === true;
          refs.buzzer.set(!cur);
        }catch(e){ alert('Could not toggle buzzer. Please try again.'); }
      };
      $('selDiv').onchange = e => refs.div.set(Number(e.target.value || 0));
      $('btnLogout').onclick = () => auth.signOut();
    }

    auth.onAuthStateChanged(u => { if(u){ show('app'); startApp(u); } else { show('login'); } });

    // ---- Humanized auth errors ----
    function friendlyAuthError(err){
      const code = (err && err.code) ? String(err.code) : '';
      switch(code){
        case 'auth/invalid-email': return 'Invalid email address. Please check and try again.';
        case 'auth/missing-password':
        case 'auth/weak-password': return 'Please enter a stronger password (at least 6 characters).';
        case 'auth/user-not-found': return 'No account for this email. Try Sign up.';
        case 'auth/wrong-password': return 'Incorrect password. Please try again.';
        case 'auth/email-already-in-use': return 'This email is already registered. Try signing in.';
        case 'auth/popup-closed-by-user': return 'Google sign-in was cancelled.';
        case 'auth/operation-not-allowed': return 'This sign-in method is disabled in Firebase console.';
        case 'auth/network-request-failed': return 'Network error. Check your connection and try again.';
        case 'auth/domain-config-required': return 'This domain is not authorized in Firebase ‚Üí Authorized domains.';
        default: return (err && err.message) ? err.message : 'Something went wrong. Please try again.';
      }
    }
    function setErr(t){ $('msg').textContent = t || ''; }

    // Basic email check to guide users early
    function looksLikeEmail(v){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v); }

    $('btnLogin').onclick = async () => {
      setErr('');
      const email = $('email').value.trim();
      const pass  = $('pass').value;
      if(!looksLikeEmail(email)) return setErr('Please enter a valid email address.');
      if(!pass) return setErr('Please enter your password.');
      try{
        await auth.signInWithEmailAndPassword(email, pass);
      }catch(e){ setErr(friendlyAuthError(e)); }
    };

    $('btnSignup').onclick = async () => {
      setErr('');
      const email = $('email').value.trim();
      const pass  = $('pass').value;
      if(!looksLikeEmail(email)) return setErr('Please enter a valid email to create your account.');
      if(!pass || pass.length < 6) return setErr('Use a password with at least 6 characters.');
      try{
        await auth.createUserWithEmailAndPassword(email, pass);
      }catch(e){ setErr(friendlyAuthError(e)); }
    };

    $('btnGoogle').onclick = async () => {
      setErr('');
      try{
        await auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
      }catch(e){ setErr(friendlyAuthError(e)); }
    };
  </script>
</body>
</html>
